<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hand Magic ‚Äî Eng: Ahmed Allam</title>

<style>
html,body{
  margin:0; padding:0; overflow:hidden;
  background:radial-gradient(circle at center,#050b14,#000);
  font-family:'Segoe UI',Arial;
}

/* Title */
#brand{
  position:fixed;top:15px;width:100%;
  text-align:center;color:#fff;z-index:10;
  pointer-events:none;
}
#brand h1{
  margin:0;font-size:34px;
  letter-spacing:3px;
  text-shadow:0 0 25px #6cf;
}
#brand p{
  margin:2px;font-size:14px;
  opacity:.8;
}

/* UI */
#panel{
  position:fixed;left:20px;top:90px;
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(12px);
  padding:14px;border-radius:14px;
  z-index:10;
}
#panel button{
  width:170px;
  margin:6px 0;
  padding:10px;
  font-size:14px;
  border:none;
  border-radius:10px;
  background:linear-gradient(135deg,#6cf,#39f);
  color:#000;
  cursor:pointer;
}
#panel input{width:170px;margin-top:10px}

/* Start */
#start{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  background:#000;z-index:20;
}
#start button{
  padding:20px 34px;
  font-size:20px;
  border:none;border-radius:14px;
  background:linear-gradient(135deg,#6cf,#39f);
  box-shadow:0 0 40px #6cf;
  cursor:pointer;
}

#status{
  position:fixed;bottom:12px;left:50%;
  transform:translateX(-50%);
  color:#fff;font-size:14px;
  opacity:.75;z-index:10;
}
</style>
</head>

<body>

<div id="brand">
  <h1>Hand Magic</h1>
  <p>by Eng: Ahmed Allam</p>
</div>

<div id="panel" style="display:none">
  <button onclick="setShape('planet')">ü™ê Planet</button>
  <button onclick="setShape('fire')">üéÜ Fireworks</button>
  <button onclick="setShape('magic')">‚ú® Magic Orb</button>
  <button onclick="setShape('heart')">‚ù§Ô∏è Heart</button>
  <button onclick="setShape('spirit')">üßò Spirit</button>
  <input type="color" id="color" value="#66ccff">
</div>

<div id="start">
  <button onclick="start()">Enter The Magic</button>
</div>

<div id="status">WAITING‚Ä¶</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
let scene,camera,renderer,mesh,video;
let positions,colors;
const COUNT = 6000;
const statusEl = document.getElementById("status");

async function start(){
  document.getElementById("start").style.display="none";
  document.getElementById("panel").style.display="block";

  const stream = await navigator.mediaDevices.getUserMedia({video:true});
  video = document.createElement("video");
  video.srcObject = stream;
  video.muted = true;
  await video.play();
  await new Promise(r=>video.readyState>=2?r():video.onloadeddata=r);

  initThree();
  setShape("planet");
  initHands();
}

function initThree(){
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(55,innerWidth/innerHeight,0.1,100);
  camera.position.z = 5;

  renderer = new THREE.WebGLRenderer({antialias:true,alpha:true});
  renderer.setSize(innerWidth,innerHeight);
  document.body.appendChild(renderer.domElement);

  const geo = new THREE.BufferGeometry();
  positions = new Float32Array(COUNT*3);
  colors = new Float32Array(COUNT*3);
  geo.setAttribute("position",new THREE.BufferAttribute(positions,3));
  geo.setAttribute("color",new THREE.BufferAttribute(colors,3));

  const mat = new THREE.PointsMaterial({
    size:0.04,
    vertexColors:true,
    transparent:true,
    opacity:0.95,
    depthWrite:false
  });

  mesh = new THREE.Points(geo,mat);
  scene.add(mesh);

  animate();
}

function animate(){
  requestAnimationFrame(animate);
  mesh.rotation.y += 0.0015;
  renderer.render(scene,camera);
}

/* ===== SHAPES ===== */
function setShape(type){
  for(let i=0;i<COUNT;i++){
    let x,y,z;
    if(type==="planet"){
      const a=Math.random()*Math.PI*2,b=Math.random()*Math.PI;
      x=1.8*Math.sin(b)*Math.cos(a);
      y=1.8*Math.cos(b);
      z=1.8*Math.sin(b)*Math.sin(a);
    }
    if(type==="fire"){
      const r=Math.random()*3,a=Math.random()*Math.PI*2,b=Math.random()*Math.PI;
      x=r*Math.sin(b)*Math.cos(a);
      y=r*Math.cos(b);
      z=r*Math.sin(b)*Math.sin(a);
    }
    if(type==="magic"){
      const t=i/COUNT*Math.PI*10;
      x=Math.cos(t)*(1+Math.sin(t*3)*.6);
      y=Math.sin(t*2)*1.2;
      z=Math.sin(t)*(1+Math.cos(t*2)*.6);
    }
    if(type==="heart"){
      const t=i/COUNT*Math.PI*2;
      x=1.4*Math.pow(Math.sin(t),3);
      y=1.1*Math.cos(t)-0.6*Math.cos(2*t);
      z=(Math.random()-.5)*1.2;
    }
    if(type==="spirit"){
      const a=Math.random()*Math.PI*2;
      x=Math.cos(a)*Math.random()*1.8;
      y=Math.sin(a*2)*1.6;
      z=Math.sin(a)*Math.random()*1.8;
    }
    positions.set([x,y,z],i*3);
    colors.set([0.4,0.8,1],i*3);
  }
  mesh.geometry.attributes.position.needsUpdate=true;
}

/* ===== HAND CONTROL ===== */
function initHands(){
  const hands = new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
  hands.setOptions({maxNumHands:1,minDetectionConfidence:.7,minTrackingConfidence:.7});
  hands.onResults(onHand);

  new Camera(video,{
    onFrame:()=>hands.send({image:video}),
    width:640,height:480
  }).start();
}

function onHand(res){
  if(!res.multiHandLandmarks || res.multiHandLandmarks.length===0){
    statusEl.textContent="MOVE YOUR HAND";
    return;
  }

  const lm = res.multiHandLandmarks[0];
  statusEl.textContent="MAGIC ACTIVE ‚ú®";

  const cx=(lm[9].x-.5)*5;
  const cy=-(lm[9].y-.5)*5;
  mesh.position.x+=(cx-mesh.position.x)*.15;
  mesh.position.y+=(cy-mesh.position.y)*.15;

  const size=Math.hypot(lm[0].x-lm[9].x,lm[0].y-lm[9].y);
  const scale=1+size*2;
  mesh.scale.set(scale,scale,scale);

  const pinch=Math.hypot(lm[4].x-lm[8].x,lm[4].y-lm[8].y)<.05;
  if(pinch) mesh.rotation.y+=.08;
}

/* ===== COLOR ===== */
document.getElementById("color").oninput=e=>{
  const c=new THREE.Color(e.target.value);
  for(let i=0;i<COUNT;i++) colors.set([c.r,c.g,c.b],i*3);
  mesh.geometry.attributes.color.needsUpdate=true;
};
</script>

</body>
</html>
