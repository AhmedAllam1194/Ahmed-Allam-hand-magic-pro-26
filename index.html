<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hand Magic by Eng: Ahmed Allam</title>

<style>
html,body{margin:0;overflow:hidden;background:#000;font-family:Arial}
#overlay{position:fixed;top:0;width:100%;text-align:center;color:#fff;padding:10px;z-index:10;pointer-events:none}
#title{font-size:26px;text-shadow:0 0 15px #7cf}
#subtitle{font-size:13px;opacity:.8}

#panel{
  position:fixed;top:80px;left:15px;z-index:10;
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(10px);
  padding:10px;border-radius:10px;
}
#panel button,#panel input{
  width:150px;margin:5px 0;
  padding:7px;border:none;border-radius:6px;
  cursor:pointer;
}
#panel button{background:#7cf}

#start{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  background:#000;z-index:20
}
#start button{
  padding:18px 30px;font-size:18px;
  border:none;border-radius:10px;
  background:#7cf;box-shadow:0 0 25px #7cf;
  cursor:pointer
}

#status{
  position:fixed;bottom:10px;left:50%;
  transform:translateX(-50%);
  color:#fff;opacity:.7;font-size:13px;z-index:10
}
</style>
</head>

<body>

<div id="overlay">
  <div id="title">Hand Magic</div>
  <div id="subtitle">by Eng: Ahmed Allam</div>
</div>

<div id="panel" style="display:none">
  <button onclick="setShape('planet')">ü™ê Planet</button>
  <button onclick="setShape('fire')">üéÜ Fireworks</button>
  <button onclick="setShape('magic')">‚ú® Magic</button>
  <button onclick="setShape('heart')">‚ù§Ô∏è Hearts</button>
  <button onclick="setShape('spirit')">üßò Spirit</button>
  <input type="color" id="color" value="#77ccff">
</div>

<div id="start">
  <button onclick="start()">Enter The Void</button>
</div>

<div id="status">WAITING‚Ä¶</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
let scene,camera,renderer,points,video;
let positions,colors;
const COUNT=3500;
let currentShape="planet";
const statusEl=document.getElementById("status");

async function start(){
  document.getElementById("start").style.display="none";
  document.getElementById("panel").style.display="block";

  const stream=await navigator.mediaDevices.getUserMedia({video:true});
  video=document.createElement("video");
  video.srcObject=stream;video.muted=true;
  await video.play();
  await new Promise(r=>video.readyState>=2?r():video.onloadeddata=r);

  initThree();
  setShape("planet");
  initHands();
}

function initThree(){
  scene=new THREE.Scene();
  camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,100);
  camera.position.z=4;

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth,innerHeight);
  document.body.appendChild(renderer.domElement);

  const geo=new THREE.BufferGeometry();
  positions=new Float32Array(COUNT*3);
  colors=new Float32Array(COUNT*3);
  geo.setAttribute("position",new THREE.BufferAttribute(positions,3));
  geo.setAttribute("color",new THREE.BufferAttribute(colors,3));

  const mat=new THREE.PointsMaterial({
    size:.03,vertexColors:true,
    transparent:true,opacity:.9
  });

  points=new THREE.Points(geo,mat);
  scene.add(points);

  animate();
}

function animate(){
  requestAnimationFrame(animate);
  points.rotation.y+=0.001;
  renderer.render(scene,camera);
}

/* ========= SHAPES ========= */
function setShape(type){
  currentShape=type;
  for(let i=0;i<COUNT;i++){
    let x,y,z;
    if(type==="planet"){
      const a=Math.random()*Math.PI*2,b=Math.random()*Math.PI;
      x=Math.sin(b)*Math.cos(a);
      y=Math.cos(b);
      z=Math.sin(b)*Math.sin(a);
    }
    if(type==="fire"){
      const r=Math.random()*2,a=Math.random()*Math.PI*2,b=Math.random()*Math.PI;
      x=r*Math.sin(b)*Math.cos(a);
      y=r*Math.cos(b);
      z=r*Math.sin(b)*Math.sin(a);
    }
    if(type==="magic"){
      const t=i/COUNT*Math.PI*8;
      x=Math.cos(t)*(0.6+Math.sin(t*3)*.3);
      y=Math.sin(t*2)*.7;
      z=Math.sin(t)*(0.6+Math.cos(t*2)*.3);
    }
    if(type==="heart"){
      const t=i/COUNT*Math.PI*2;
      x=0.8*Math.pow(Math.sin(t),3);
      y=0.6*Math.cos(t)-0.3*Math.cos(2*t);
      z=(Math.random()-.5)*.5;
    }
    if(type==="spirit"){
      const a=Math.random()*Math.PI*2;
      x=Math.cos(a)*Math.random();
      y=Math.sin(a*2)*.8;
      z=Math.sin(a)*Math.random();
    }
    positions.set([x,y,z],i*3);
    colors.set([0.5,0.8,1],i*3);
  }
  points.geometry.attributes.position.needsUpdate=true;
}

/* ========= HAND ========= */
function initHands(){
  const hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
  hands.setOptions({maxNumHands:1,minDetectionConfidence:.7,minTrackingConfidence:.7});
  hands.onResults(onHand);

  new Camera(video,{
    onFrame:()=>hands.send({image:video}),
    width:640,height:480
  }).start();
}

function onHand(res){
  if(!res.multiHandLandmarks){statusEl.textContent="NO HAND";return;}
  const lm=res.multiHandLandmarks[0];
  statusEl.textContent="HAND ACTIVE";

  const cx=(lm[9].x-.5)*4;
  const cy=-(lm[9].y-.5)*4;
  points.position.x+=(cx-points.position.x)*.1;
  points.position.y+=(cy-points.position.y)*.1;

  const pinch=Math.hypot(lm[4].x-lm[8].x,lm[4].y-lm[8].y)<.05;
  if(pinch){points.rotation.y+=.05;statusEl.textContent="MAGIC SWIRL";}
}

/* ========= COLOR ========= */
document.getElementById("color").oninput=e=>{
  const c=new THREE.Color(e.target.value);
  for(let i=0;i<COUNT;i++) colors.set([c.r,c.g,c.b],i*3);
  points.geometry.attributes.color.needsUpdate=true;
};
</script>

</body>
</html>
